Router.configure({    loadingTemplate: 'loading',    notFoundTemplate: 'notFound',});this.PublicController = RouteController.extend({    layoutTemplate: "publicLayout",});this.DashboardController = RouteController.extend({    layoutTemplate: 'layout',    // Subscriptions or other things we want to "wait" on.    waitOn: function () {        if (Meteor.user()) {            var userIds = _.map(Meteor.user().profile.friends, function (f) {                return f._id;            });            var subscriptions = _.map(userIds, function(fId) {                return Meteor.subscribe('recentChats', fId);            });            subscriptions.push(Meteor.subscribe('friends', userIds));            return subscriptions;        }    },    onBeforeAction: function() {        if (Meteor.loggingIn()) {            return this.render("loading");        } else if (Meteor.user()) {            return this.next();        } else {            return this.redirect("/");        }    }});Router.route('index',{    path:'/',    controller: 'PublicController',    action: function(){        if(Meteor.user()){            this.layout("layout");            return this.render("home");        }else{            this.layout("publicLayout");            return this.render("publicHome");        }    }    });Router.route('inflate.drivers', {    path: '/inflate/drivers',    layoutTemplate: 'tabsLayout'    });Router.route('inflate.drives', {    path: '/inflate/drives',    layoutTemplate: 'tabsLayout'    });Router.route('/about', {    name: 'about',    controller: 'DashboardController',    });Router.route('/profile', {    name: 'profileTemplate',    controller: 'DashboardController',    });Router.route('/changePswd',{    name: 'changePswd',    controller: 'DashboardController',});Router.route('/changeAvatar',{    name:'changeAvatar',    controller:'DashboardController'});Router.route('/contacts',{    name:"myContacts",    controller:'DashboardController'});Router.route('/profile/:_id',{    name: 'profileView',    template: 'profileView',    controller: 'DashboardController',    data: function() {        var _id = this.params._id;        return {user: Meteor.users.findOne({_id: _id})};    },    action: function() {        if (this.data().user) {            this.render('profileView');        } else {            this.redirect('index');        }    }});Router.route('/signIn',{    name: 'userAccountsIonic',    controller: 'PublicController',});Router.plugin('ensureSignedIn', {    except: ['userAccountsIonic','index']});